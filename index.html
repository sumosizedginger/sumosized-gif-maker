<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video to GIF Converter</title>
    <script>
        // Register the COI service worker to enable SharedArrayBuffer for FFmpeg.wasm
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./coi-serviceworker.js').then(() => {
                // If the page wasn't already controlled, reload to activate the SW
                if (!navigator.serviceWorker.controller) {
                    window.location.reload();
                }
            });
        }
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gifshot/0.3.2/gifshot.min.js"></script>
    <script src="https://unpkg.com/@ffmpeg/ffmpeg@0.11.6/dist/ffmpeg.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/color-thief/2.3.0/color-thief.umd.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="js/utils.js"></script>
    <link rel="manifest" href="manifest.json">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600&family=Outfit:wght@600;700;800&display=swap"
        rel="stylesheet">
    <style>
        :root {
            /* Core Blues (Primary Backgrounds) */
            --navy: #002244;
            --oxford: #002147;
            --midnight: #191970;
            --sapphire: #082567;
            --prussian: #003153;
            --charcoal: #1F2328;

            /* Core Greens (Primary Accents) */
            --action-green: #4DFF00;
            --forest: #228B22;
            --racing: #004225;
            --hunter: #355E3B;
            --sacramento: #043927;
            --jungle: #1A2421;

            /* UI Tokens */
            --vibe-color: #4DFF00;
            --glass: rgba(0, 34, 68, 0.7);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-primary: #ffffff;
            --text-secondary: rgba(255, 255, 255, 0.7);
            --transition: all 0.4s cubic-bezier(0.23, 1, 0.32, 1);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', sans-serif;
            background: radial-gradient(circle at top right, var(--oxford), var(--navy), #000);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 40px 20px;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            position: relative;
        }

        /* Ambient Glows */
        .container::before {
            content: '';
            position: absolute;
            top: -100px;
            left: -100px;
            width: 300px;
            height: 300px;
            background: var(--action-green);
            filter: blur(150px);
            opacity: 0.1;
            z-index: -1;
        }

        header {
            text-align: center;
            margin-bottom: 50px;
            animation: fadeInDown 1s var(--transition);
        }

        h1 {
            font-family: 'Outfit', sans-serif;
            font-size: 3.5rem;
            font-weight: 800;
            letter-spacing: -1px;
            background: linear-gradient(to bottom, #fff, var(--text-secondary));
            -webkit-background-clip: text;
            background-clip: text;
            -webkit-text-fill-color: transparent;
            margin-bottom: 12px;
            text-transform: uppercase;
        }

        .subtitle {
            font-size: 1.1rem;
            color: var(--action-green);
            text-transform: uppercase;
            letter-spacing: 3px;
            font-weight: 600;
            opacity: 0.9;
        }

        .main-card {
            background: var(--glass);
            backdrop-filter: blur(24px);
            -webkit-backdrop-filter: blur(24px);
            border: 1px solid var(--glass-border);
            border-radius: 32px;
            box-shadow: 0 40px 100px rgba(0, 0, 0, 0.5), inset 0 0 40px rgba(255, 255, 255, 0.02);
            overflow: hidden;
            animation: fadeInUp 1s var(--transition);
        }

        .upload-section {
            padding: 80px 40px;
            background: rgba(0, 0, 0, 0.2);
            text-align: center;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }

        .upload-btn {
            display: inline-block;
            padding: 18px 48px;
            background: var(--action-green);
            color: var(--navy);
            border-radius: 100px;
            cursor: pointer;
            font-weight: 800;
            font-size: 1.2rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            transition: var(--transition);
            box-shadow: 0 0 20px rgba(77, 255, 0, 0.3);
            font-family: 'Outfit', sans-serif;
        }

        .upload-btn:hover {
            transform: translateY(-4px) scale(1.02);
            box-shadow: 0 0 40px rgba(77, 255, 0, 0.5);
            background: #fff;
        }

        input[type="file"] {
            display: none;
        }

        .video-section {
            display: none;
            padding: 30px;
            background: #000;
            position: relative;
        }

        .video-section.active {
            display: block;
        }

        video {
            width: 100%;
            max-height: 500px;
            display: block;
            border-radius: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .controls-panel {
            padding: 40px;
            background: rgba(0, 0, 0, 0.3);
        }

        .time-controls {
            margin-bottom: 40px;
        }

        .time-display {
            display: flex;
            justify-content: space-between;
            margin-bottom: 15px;
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .time-display span span {
            color: var(--action-green);
            font-weight: 700;
        }

        .range-container {
            position: relative;
            height: 48px;
            margin: 20px 0;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 24px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .range-slider {
            position: absolute;
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        .range-selected {
            position: absolute;
            height: 4px;
            background: var(--action-green);
            box-shadow: 0 0 15px var(--action-green);
            border-radius: 2px;
            top: 50%;
            transform: translateY(-50%);
            pointer-events: none;
        }

        input[type="range"] {
            position: absolute;
            width: 100%;
            height: 100%;
            background: transparent;
            pointer-events: none;
            -webkit-appearance: none;
            appearance: none;
            top: 0;
            margin: 0;
        }

        input[type="range"]::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 24px;
            height: 24px;
            background: #fff;
            border: 4px solid var(--action-green);
            border-radius: 50%;
            cursor: pointer;
            pointer-events: auto;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.4);
            transition: var(--transition);
        }

        input[type="range"]::-webkit-slider-thumb:hover {
            transform: scale(1.2);
            background: var(--action-green);
        }

        .settings-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 24px;
            margin-top: 20px;
        }

        .setting-group {
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .setting-label {
            font-size: 0.75rem;
            font-weight: 800;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 1.5px;
        }

        .setting-input {
            padding: 14px;
            background: rgba(255, 255, 255, 0.05);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            font-size: 1rem;
            color: white;
            transition: var(--transition);
        }

        .setting-input:focus {
            outline: none;
            border-color: var(--action-green);
            background: rgba(255, 255, 255, 0.1);
            box-shadow: 0 0 20px rgba(77, 255, 0, 0.1);
        }

        /* Phase 2 Enhanced Components */
        .feature-tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 30px;
            padding: 5px;
            background: rgba(0, 0, 0, 0.3);
            border-radius: 100px;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }

        .tab-btn {
            flex: 1;
            padding: 12px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-family: 'Outfit', sans-serif;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-size: 0.8rem;
            border-radius: 100px;
            cursor: pointer;
            transition: var(--transition);
        }

        .tab-btn.active {
            background: var(--action-green);
            color: var(--navy);
            box-shadow: 0 5px 15px rgba(77, 255, 0, 0.2);
        }

        .advanced-panel {
            display: none;
            margin-top: 30px;
            animation: fadeIn 0.4s var(--transition);
        }

        .advanced-panel.active {
            display: block;
        }

        .filter-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(130px, 1fr));
            gap: 15px;
        }

        .filter-card {
            background: rgba(255, 255, 255, 0.03);
            border: 1px solid rgba(255, 255, 255, 0.05);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            cursor: pointer;
            transition: var(--transition);
        }

        .filter-card:hover {
            background: rgba(255, 255, 255, 0.08);
            transform: translateY(-2px);
        }

        .filter-card.active {
            border-color: var(--action-green);
            background: rgba(77, 255, 0, 0.05);
            box-shadow: inset 0 0 10px rgba(77, 255, 0, 0.1);
        }

        .filter-label {
            display: block;
            margin-top: 8px;
            font-size: 0.7rem;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .size-predictor {
            margin-top: 20px;
            padding: 15px;
            background: rgba(77, 255, 0, 0.05);
            border-radius: 12px;
            border-left: 4px solid var(--action-green);
            font-family: 'Outfit', sans-serif;
            font-size: 0.85rem;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .size-val {
            font-weight: 800;
            color: var(--action-green);
        }

        .timeline-container {
            position: relative;
            padding-top: 20px;
        }

        .frame-preview-bar {
            height: 40px;
            background: rgba(0, 0, 0, 0.4);
            border-radius: 4px;
            margin-bottom: 5px;
            overflow: hidden;
            display: flex;
        }

        .frame-strip {
            height: 100%;
            flex: 1;
            background-size: cover;
            background-position: center;
            opacity: 0.5;
            transition: opacity 0.2s;
        }

        .frame-strip:hover {
            opacity: 1;
        }

        .action-section {
            padding: 40px;
            text-align: center;
            background: rgba(0, 0, 0, 0.2);
        }

        .btn {
            padding: 16px 40px;
            border: none;
            border-radius: 100px;
            font-size: 1rem;
            font-weight: 700;
            cursor: pointer;
            transition: var(--transition);
            margin: 10px;
            display: inline-flex;
            align-items: center;
            gap: 12px;
            font-family: 'Outfit', sans-serif;
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        .btn-primary {
            background: var(--action-green);
            color: var(--navy);
            box-shadow: 0 10px 30px rgba(77, 255, 0, 0.2);
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-3px);
            box-shadow: 0 15px 40px rgba(77, 255, 0, 0.4);
            background: #fff;
        }

        .btn-primary:disabled {
            opacity: 0.3;
            filter: grayscale(1);
            cursor: not-allowed;
        }

        .btn-secondary {
            background: rgba(255, 255, 255, 0.1);
            color: white;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .btn-secondary:hover {
            background: rgba(255, 255, 255, 0.2);
            border-color: rgba(255, 255, 255, 0.3);
        }

        .progress-container {
            margin-top: 40px;
            display: none;
        }

        .progress-container.active {
            display: block;
        }

        .progress-info {
            display: flex;
            justify-content: space-between;
            margin-bottom: 12px;
            font-weight: 700;
            color: var(--text-secondary);
            font-size: 0.9rem;
            text-transform: uppercase;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.05);
            border-radius: 100px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--action-green);
            width: 0%;
            transition: width 0.3s ease;
            box-shadow: 0 0 15px var(--action-green);
        }

        .preview-section {
            display: none;
            padding: 50px 40px;
            background: rgba(0, 0, 0, 0.4);
            text-align: center;
            border-top: 1px solid rgba(255, 255, 255, 0.05);
        }

        .preview-section.active {
            display: block;
            animation: fadeIn 0.8s var(--transition);
        }

        .preview-image {
            max-width: 100%;
            border-radius: 20px;
            border: 2px solid var(--action-green);
            box-shadow: 0 30px 60px rgba(0, 0, 0, 0.4);
            margin-bottom: 30px;
        }

        .video-info {
            display: flex;
            justify-content: center;
            gap: 30px;
            margin-top: 20px;
            color: var(--text-secondary);
            font-size: 0.8rem;
            text-transform: uppercase;
            letter-spacing: 1px;
            font-weight: 600;
        }

        .toast {
            position: fixed;
            bottom: 40px;
            left: 50%;
            transform: translateX(-50%) translateY(100px);
            background: var(--action-green);
            color: var(--navy);
            padding: 16px 32px;
            border-radius: 100px;
            font-weight: 800;
            text-transform: uppercase;
            letter-spacing: 1px;
            opacity: 0;
            transition: var(--transition);
            z-index: 1000;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.4);
            font-family: 'Outfit', sans-serif;
            font-size: 0.9rem;
        }

        .toast.show {
            transform: translateX(-50%) translateY(0);
            opacity: 1;
        }

        .trim-hint {
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.8rem;
            margin-top: 12px;
            font-weight: 500;
        }

        @keyframes fadeInDown {
            from {
                opacity: 0;
                transform: translateY(-40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInUp {
            from {
                opacity: 0;
                transform: translateY(40px);
            }

            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .animate-spin {
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            from {
                transform: rotate(0deg);
            }

            to {
                transform: rotate(360deg);
            }
        }

        /* Pro Cropper UI */
        .video-container {
            position: relative;
            cursor: crosshair;
            overflow: hidden;
            border-radius: 20px;
        }

        .cropper-overlay {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            display: none;
            z-index: 10;
        }

        .cropper-overlay.active {
            display: block;
        }

        .cropper-box {
            position: absolute;
            border: 2px solid var(--action-green);
            box-shadow: 0 0 0 9999px rgba(0, 0, 0, 0.5), 0 0 20px var(--action-green);
            pointer-events: none;
        }

        .cropper-box::after {
            content: 'CROP AREA';
            position: absolute;
            top: -25px;
            left: 0;
            background: var(--action-green);
            color: var(--navy);
            font-size: 10px;
            font-weight: 800;
            padding: 2px 8px;
            border-radius: 4px;
        }

        /* Icon Tweaks */
        .tab-btn i,
        .btn i {
            width: 18px;
            height: 18px;
            margin-right: 8px;
            vertical-align: middle;
        }

        @keyframes fadeIn {
            from {
                opacity: 0;
            }

            to {
                opacity: 1;
            }
        }

        @media (max-width: 768px) {
            h1 {
                font-size: 1.8rem;
            }

            .settings-grid {
                grid-template-columns: 1fr;
            }

            .btn {
                margin: 5px;
                width: 100%;
                justify-content: center;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header>
            <h1>üé¨ Video to GIF Converter</h1>
            <p class="subtitle">Trim and convert any video section to animated GIF</p>
        </header>

        <div class="main-card">
            <div class="upload-section" id="uploadSection">
                <label for="videoInput" class="upload-btn">
                    üìÅ Select Video File
                </label>
                <input type="file" id="videoInput" accept="video/*">
                <p style="margin-top: 15px; color: #6c757d;">Supports MP4, MOV, WebM, AVI, and more</p>
            </div>

            <div class="video-section" id="videoSection">
                <div class="video-container" id="videoContainer">
                    <video id="videoPlayer"></video>
                    <div class="cropper-overlay" id="cropperOverlay">
                        <div class="cropper-box" id="cropperBox"></div>
                    </div>
                </div>
                <div class="video-info" id="videoInfo"></div>
            </div>

            <div class="controls-panel" id="controlsPanel" style="display: none;">
                <div class="time-controls">
                    <div class="time-display">
                        <span>Start: <span id="startTimeDisplay">0.0s</span></span>
                        <span>Duration: <span id="durationDisplay">2.0s</span></span>
                        <span>End: <span id="endTimeDisplay">2.0s</span></span>
                    </div>

                    <div class="range-container">
                        <div class="range-slider"></div>
                        <div class="range-selected" id="rangeSelected"></div>
                        <input type="range" id="startRange" min="0" max="100" value="0" step="0.1">
                        <input type="range" id="endRange" min="0" max="100" value="20" step="0.1">
                    </div>

                    <p class="trim-hint">Drag handles to trim video section (Max 10 seconds recommended)</p>
                </div>

                <div class="feature-tabs">
                    <button class="tab-btn active" onclick="switchTab('settings')">
                        <i data-lucide="settings"></i> Settings
                    </button>
                    <button class="tab-btn" onclick="switchTab('filters')">
                        <i data-lucide="sparkles"></i> Filters
                    </button>
                    <button class="tab-btn" onclick="switchTab('overlays')">
                        <i data-lucide="type"></i> Overlays
                    </button>
                </div>

                <!-- Settings Panel -->
                <div id="settingsPanel" class="advanced-panel active">
                    <div class="settings-grid">
                        <div class="setting-group">
                            <label class="setting-label">Width (px)</label>
                            <input type="number" id="gifWidth" class="setting-input" value="480" min="100" max="1024"
                                step="10">
                        </div>

                        <div class="setting-group">
                            <label class="setting-label">Frame Rate (FPS)</label>
                            <input type="number" id="fps" class="setting-input" value="15" min="1" max="60" step="1">
                        </div>

                        <div class="setting-group">
                            <label class="setting-label">Speed</label>
                            <select id="speed" class="setting-input" onchange="updatePredictor()">
                                <option value="0.5">0.5x (Slow)</option>
                                <option value="1" selected>1.0x (Normal)</option>
                                <option value="1.5">1.5x (Fast)</option>
                                <option value="2">2.0x (Turbo)</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label">Loop Mode</label>
                            <select id="loopMode" class="setting-input" onchange="updatePredictor()">
                                <option value="normal" selected>Normal</option>
                                <option value="reverse">Reverse</option>
                                <option value="boomerang">Boomerang</option>
                            </select>
                        </div>

                        <div class="setting-group">
                            <label class="setting-label">Pro Crop</label>
                            <select id="cropRatio" class="setting-input" onchange="toggleCropper(this.value)">
                                <option value="off" selected>Off (Full)</option>
                                <option value="original">Free Crop</option>
                                <option value="9:16">TikTok (9:16)</option>
                                <option value="1:1">Instagram (1:1)</option>
                                <option value="4:5">FB/Portalt (4:5)</option>
                            </select>
                        </div>
                    </div>
                </div>

                <!-- Filters Panel -->
                <div id="filtersPanel" class="advanced-panel">
                    <div class="filter-grid" id="filterGrid">
                        <div class="filter-card active" onclick="setFilter('none', this)">
                            <span class="filter-label">None</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('grayscale', this)">
                            <span class="filter-label">Noir</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('sepia', this)">
                            <span class="filter-label">Retro</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('vibrant', this)">
                            <span class="filter-label">Vibrant Pop</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('8bit', this)">
                            <span class="filter-label">8-Bit Retro</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('dreamy', this)">
                            <span class="filter-label">Dreamy Wash</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('golden', this)">
                            <span class="filter-label">Golden Hour</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('gladiator', this)">
                            <span class="filter-label">Gladiator</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('nightvision', this)">
                            <span class="filter-label">Night Vision</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('sulphur', this)">
                            <span class="filter-label">Sulphur</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('coldblue', this)">
                            <span class="filter-label">Cold Blue</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('vignette', this)">
                            <span class="filter-label">Vignette</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('mirror', this)">
                            <span class="filter-label">Mirror Flip</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('grain', this)">
                            <span class="filter-label">Film Grain</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('invert', this)">
                            <span class="filter-label">Invert</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('vhs', this)">
                            <span class="filter-label">üìº VHS Retro</span>
                        </div>
                        <div class="filter-card" onclick="setFilter('psychedelic', this)">
                            <span class="filter-label">üåà Psychedelia</span>
                        </div>
                    </div>
                </div>

                <!-- Overlays Panel -->
                <div id="overlaysPanel" class="advanced-panel">
                    <div class="setting-group">
                        <label class="setting-label">Overlay Text</label>
                        <input type="text" id="overlayText" class="setting-input" placeholder="Enter caption..."
                            oninput="updatePredictor()">
                    </div>
                    <div class="settings-grid" style="margin-top: 15px;">
                        <div class="setting-group">
                            <label class="setting-label">Size</label>
                            <input type="number" id="textSize" class="setting-input" value="32" min="10" max="100">
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Position</label>
                            <select id="textPos" class="setting-input">
                                <option value="top">Top</option>
                                <option value="middle">Middle</option>
                                <option value="bottom" selected>Bottom</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Word Spacing</label>
                            <input type="number" id="wordSpacing" class="setting-input" value="1" min="0" max="50">
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Font Family</label>
                            <select id="fontStyle" class="setting-input">
                                <option value="arial.ttf">Standard (Arial)</option>
                                <option value="Anton-Regular.ttf">Anton (Headline)</option>
                                <option value="Orbitron.ttf">Orbitron (Sci-Fi)</option>
                                <option value="PermanentMarker-Regular.ttf">Marker (Street)</option>
                                <option value="Montserrat-Regular.ttf">Montserrat (Modern)</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Line Spacing</label>
                            <input type="number" id="lineSpacing" class="setting-input" value="20" min="0" max="100">
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Text Box</label>
                            <select id="textBox" class="setting-input">
                                <option value="0" selected>None</option>
                                <option value="1">Background Slug</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Text Color</label>
                            <select id="textColor" class="setting-input">
                                <option value="white" selected>White</option>
                                <option value="black">Black</option>
                                <option value="yellow">Yellow</option>
                                <option value="red">Red</option>
                                <option value="cyan">Cyan</option>
                                <option value="#4DFF00">Action Green</option>
                            </select>
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Box Padding</label>
                            <input type="number" id="boxPadding" class="setting-input" value="10" min="0" max="50">
                        </div>
                        <div class="setting-group">
                            <label class="setting-label">Box Opacity</label>
                            <input type="number" id="boxOpacity" class="setting-input" value="0.5" min="0" max="1"
                                step="0.1">
                        </div>
                    </div>
                </div>

                <div class="size-predictor">
                    <span>Quality Index: <span class="size-val" id="qualityEst">Ultra High</span></span>
                    <span>| Processor: <span class="size-val">Elite (FFmpeg)</span></span>
                </div>
            </div>

            <div class="action-section" id="actionSection" style="display: none;">
                <button class="btn btn-primary" id="convertBtn" onclick="startConversion()">
                    ‚ö° Convert to GIF
                </button>
                <button class="btn btn-secondary" onclick="resetVideo()">
                    üóëÔ∏è New Video
                </button>

                <div class="progress-container" id="progressContainer">
                    <div class="progress-info">
                        <span id="progressStatus">Extracting frames...</span>
                        <span id="progressPercent">0%</span>
                    </div>
                    <div class="progress-bar">
                        <div class="progress-fill" id="progressFill"></div>
                    </div>
                </div>
            </div>

            <div class="preview-section" id="previewSection">
                <h3 style="margin-bottom: 20px; color: #495057;">‚ú® Your GIF is Ready!</h3>
                <img id="resultGif" class="preview-image" src="" alt="Generated GIF">
                <div>
                    <a id="downloadBtn" class="btn btn-primary" download="converted.gif">
                        ‚¨áÔ∏è Download GIF
                    </a>
                    <button class="btn btn-secondary" onclick="closePreview()">
                        üîÑ Convert Another Section
                    </button>
                </div>
            </div>
        </div>
    </div>

    <div class="toast" id="toast"></div>

    <script>
        const CONFIG = {
            FFMPEG_CORE_URL: 'https://unpkg.com/@ffmpeg/core@0.11.0/dist/ffmpeg-core.js',
            // Resolve absolute base URL for fonts to satisfy ffmpeg.wasm's fetchFile
            FONT_BASE_URL: window.location.origin + window.location.pathname.replace(/\/[^\/]*$/, '') + '/fonts/'
        };

        const { createFFmpeg, fetchFile } = FFmpeg;
        const ffmpeg = createFFmpeg({
            log: true,
            corePath: CONFIG.FFMPEG_CORE_URL
        });

        let videoDuration = 0;
        let isConverting = false;
        let currentFilter = 'none';
        let currentVideoFile = null;

        const colorThief = new ColorThief();

        // Initialize Lucide Icons
        if (typeof lucide !== 'undefined') {
            lucide.createIcons();
        }

        async function syncVibe() {
            const videoPlayer = document.getElementById('videoPlayer');
            if (!videoPlayer) return;

            if (!videoPlayer.paused || videoPlayer.currentTime > 0) {
                const canvas = document.createElement('canvas');
                canvas.width = videoPlayer.videoWidth;
                canvas.height = videoPlayer.videoHeight;
                const ctx = canvas.getContext('2d');
                ctx.drawImage(videoPlayer, 0, 0, canvas.width, canvas.height);

                try {
                    const color = colorThief.getColor(canvas);
                    const rgb = `rgb(${color[0]}, ${color[1]}, ${color[2]})`;
                    document.documentElement.style.setProperty('--vibe-color', rgb);
                    document.documentElement.style.setProperty('--glass-border', `rgba(${color[0]}, ${color[1]}, ${color[2]}, 0.3)`);
                } catch (e) {
                    console.warn("Vibe sync failed:", e);
                }
            }
        }

        document.addEventListener('change', function (e) {
            if (e.target && e.target.id === 'videoInput') {
                const videoInput = e.target;
                const videoSection = document.getElementById('videoSection');
                const videoPlayer = document.getElementById('videoPlayer');
                const controlsPanel = document.getElementById('controlsPanel');
                const actionSection = document.getElementById('actionSection');
                const startRange = document.getElementById('startRange');
                const endRange = document.getElementById('endRange');

                const file = videoInput.files[0];
                if (file) {
                    if (videoPlayer.src) {
                        URL.revokeObjectURL(videoPlayer.src);
                    }
                    currentVideoFile = file;
                    const url = URL.createObjectURL(file);
                    videoPlayer.src = url;
                    videoSection.classList.add('active');

                    videoPlayer.onloadedmetadata = function () {
                        videoDuration = videoPlayer.duration;

                        // Trigger initial vibe sync after metadata loads
                        setTimeout(syncVibe, 500);

                        document.getElementById('videoInfo').innerHTML = `
                            <span>üìπ ${file.name}</span>
                            <span>‚è±Ô∏è ${formatTime(videoDuration)}</span>
                            <span>üìê ${Math.round(videoPlayer.videoWidth)}x${Math.round(videoPlayer.videoHeight)}</span>
                        `;

                        startRange.max = videoDuration;
                        endRange.max = videoDuration;
                        endRange.value = Math.min(2, videoDuration);

                        controlsPanel.style.display = 'block';
                        actionSection.style.display = 'block';
                        updateRange();
                        updatePredictor();
                    };
                }
            }
        });

        function switchTab(tabId) {
            document.querySelectorAll('.advanced-panel').forEach(p => p.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));

            document.getElementById(tabId + 'Panel').classList.add('active');
            event.target.classList.add('active');
        }

        function setFilter(filter, el) {
            currentFilter = filter;
            document.querySelectorAll('.filter-card').forEach(c => c.classList.remove('active'));
            el.classList.add('active');
            updatePredictor();
        }

        function updatePredictor() {
            const widthInput = document.getElementById('gifWidth');
            const fpsInput = document.getElementById('fps');
            const speedInput = document.getElementById('speed');
            const overlayInput = document.getElementById('overlayText');
            const qualityEst = document.getElementById('qualityEst');

            if (!widthInput || !fpsInput || !speedInput || !overlayInput || !qualityEst) return;

            const width = parseInt(widthInput.value);
            const fps = parseInt(fpsInput.value);
            const speed = parseFloat(speedInput.value);
            const hasOverlay = overlayInput.value.length > 0;

            let quality = "High Def";
            if (width > 800) quality = "Ultra HD";
            else if (width < 320) quality = "Standard";

            if (fps > 25) quality += " (Super Smooth)";
            if (hasOverlay) quality += " + FX";

            qualityEst.textContent = quality;
        }

        function updateRange() {
            const startRange = document.getElementById('startRange');
            const endRange = document.getElementById('endRange');
            const rangeSelected = document.getElementById('rangeSelected');
            const startTimeDisplay = document.getElementById('startTimeDisplay');
            const endTimeDisplay = document.getElementById('endTimeDisplay');
            const durationDisplay = document.getElementById('durationDisplay');

            if (!startRange || !endRange) return;

            let start = parseFloat(startRange.value);
            let end = parseFloat(endRange.value);

            // Ensure minimum 0.5s duration and start < end
            if (end - start < 0.5) {
                if (event && event.target === startRange) {
                    start = end - 0.5;
                    startRange.value = start;
                } else {
                    end = start + 0.5;
                    endRange.value = end;
                }
            }

            if (start > end) {
                const temp = start;
                start = end;
                end = temp;
            }

            // Update visual range
            const leftPercent = (start / videoDuration) * 100;
            const widthPercent = ((end - start) / videoDuration) * 100;

            if (rangeSelected) {
                rangeSelected.style.left = leftPercent + '%';
                rangeSelected.style.width = widthPercent + '%';
            }

            // Update displays
            if (startTimeDisplay) startTimeDisplay.textContent = start.toFixed(1) + 's';
            if (endTimeDisplay) endTimeDisplay.textContent = end.toFixed(1) + 's';
            if (durationDisplay) durationDisplay.textContent = (end - start).toFixed(1) + 's';
        }

        startRange.addEventListener('input', updateRange);
        endRange.addEventListener('input', updateRange);

        let cropData = { active: false, x: 0, y: 0, w: 0, h: 0, ratio: 'off' };
        let isDragging = false;
        let startX, startY;

        function toggleCropper(ratio) {
            const videoPlayer = document.getElementById('videoPlayer');
            const overlay = document.getElementById('cropperOverlay');
            const box = document.getElementById('cropperBox');

            if (!videoPlayer || !overlay) return;

            if (ratio === 'off') {
                overlay.classList.remove('active');
                cropData.active = false;
                return;
            }

            overlay.classList.add('active');
            cropData.active = true;
            cropData.ratio = ratio;

            // Reset box to center
            const rect = videoPlayer.getBoundingClientRect();
            let w = rect.width * 0.8;
            let h = rect.height * 0.8;

            if (ratio !== 'original') {
                const [rW, rH] = ratio.split(':').map(Number);
                const targetRatio = rW / rH;
                if (w / h > targetRatio) w = h * targetRatio;
                else h = w / targetRatio;
            }

            cropData.w = w;
            cropData.h = h;
            cropData.x = (rect.width - w) / 2;
            cropData.y = (rect.height - h) / 2;

            updateCropperUI();
        }

        function updateCropperUI() {
            const box = document.getElementById('cropperBox');
            box.style.left = cropData.x + 'px';
            box.style.top = cropData.y + 'px';
            box.style.width = cropData.w + 'px';
            box.style.height = cropData.h + 'px';
        }

        const videoContainer = document.getElementById('videoContainer');
        videoContainer.addEventListener('mousedown', e => {
            if (!cropData.active) return;
            isDragging = true;
            startX = e.offsetX;
            startY = e.offsetY;

            // If clicking outside box, start new box
            if (cropData.ratio === 'original') {
                cropData.x = startX;
                cropData.y = startY;
                cropData.w = 0;
                cropData.h = 0;
            }
        });

        window.addEventListener('mousemove', e => {
            if (!isDragging) return;
            const rect = videoContainer.getBoundingClientRect();
            let curX = Math.max(0, Math.min(e.clientX - rect.left, rect.width));
            let curY = Math.max(0, Math.min(e.clientY - rect.top, rect.height));

            if (cropData.ratio === 'original') {
                cropData.w = Math.abs(curX - startX);
                cropData.h = Math.abs(curY - startY);
                cropData.x = Math.min(curX, startX);
                cropData.y = Math.min(curY, startY);
            } else {
                // Move logic for fixed ratio (simple center-drag for now)
                cropData.x = Math.max(0, Math.min(curX - cropData.w / 2, rect.width - cropData.w));
                cropData.y = Math.max(0, Math.min(curY - cropData.h / 2, rect.height - cropData.h));
            }
            updateCropperUI();
        });

        window.addEventListener('mouseup', () => isDragging = false);

        // Initialize Lucide Icons initially
        window.addEventListener('load', () => {
            if (typeof lucide !== 'undefined') lucide.createIcons();
        });

        // FFmpeg Initialization with Logger
        let ffmpegLogs = [];
        (async () => {
            try {
                // Enable console logging for diagnostics
                ffmpeg.setLogger(({ type, message }) => {
                    console.log(`[FFmpeg ${type}] ${message}`);
                    if (type === 'fferr') {
                        ffmpegLogs.push(message);
                        if (ffmpegLogs.length > 5) ffmpegLogs.shift();
                    }
                });

                if (!ffmpeg.isLoaded()) {
                    await ffmpeg.load();
                    showToast("Elite Processor Ready");
                }
            } catch (e) {
                console.error(e);
                showToast("System Error: Cross-Origin Isolation Required");
            }
        })();

        function wrapText(text, maxWidth, fontSize, fontName, wordSpacing = 0) {
            const canvas = document.createElement('canvas');
            const ctx = canvas.getContext('2d');
            ctx.font = `${fontSize}px "${fontName}", Arial`;

            // Measure the exact width of a space in the current font
            const spaceWidth = ctx.measureText(' ').width;
            const extraSpacingPx = wordSpacing * spaceWidth;

            const words = text.split(' ');
            let lines = [];
            let currentLine = [];

            words.forEach(word => {
                const testLine = [...currentLine, word];
                const testText = testLine.join(' ');
                const metrics = ctx.measureText(testText);
                // Total width = text width + (number of gaps * extra spacing per gap)
                const totalWidth = metrics.width + (Math.max(0, testLine.length - 1) * extraSpacingPx);

                if (totalWidth > maxWidth && currentLine.length > 0) {
                    lines.push(currentLine.join(' '));
                    currentLine = [word];
                } else {
                    currentLine = testLine;
                }
            });
            if (currentLine.length > 0) {
                lines.push(currentLine.join(' '));
            }

            // After wrapping, inject the extra spaces for the FFmpeg workaround
            const spacingStr = ' '.repeat(wordSpacing + 1);
            return lines.map(l => l.split(' ').join(spacingStr)).join('\n');
        }

        async function startConversion() {
            if (isConverting) return;
            if (!ffmpeg.isLoaded()) {
                showToast("Processor Loading...");
                await ffmpeg.load();
            }

            // Fresh lookups for stability during reloads
            const startRange = document.getElementById('startRange');
            const endRange = document.getElementById('endRange');
            const durationDisplay = document.getElementById('durationDisplay');
            const gifWidthInput = document.getElementById('gifWidth');
            const fpsInput = document.getElementById('fps');
            const speedSelect = document.getElementById('speed');
            const loopModeSelect = document.getElementById('loopMode');
            const overlayTextInput = document.getElementById('overlayText');
            const textSizeInput = document.getElementById('textSize');
            const textPosSelect = document.getElementById('textPos');
            const convertBtn = document.getElementById('convertBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');
            const progressPercent = document.getElementById('progressPercent');
            const progressStatus = document.getElementById('progressStatus');
            const videoPlayer = document.getElementById('videoPlayer');

            if (!startRange || !durationDisplay || !convertBtn || !progressContainer || !videoPlayer) {
                showToast("Page not ready ‚Äî please reload.");
                return;
            }

            const start = parseFloat(startRange.value);
            const duration = parseFloat(durationDisplay.textContent);
            const width = parseInt(gifWidthInput.value);
            const fps = parseInt(fpsInput.value);
            const speed = parseFloat(speedSelect.value);
            const loopMode = loopModeSelect.value;
            const overlayText = overlayTextInput.value;
            const textSize = parseInt(textSizeInput.value);
            const textPos = textPosSelect.value;
            const fontStyle = document.getElementById('fontStyle').value;

            convertBtn.disabled = true;
            convertBtn.innerHTML = '<i data-lucide="loader-2" class="animate-spin"></i> Processing...';
            if (typeof lucide !== 'undefined') lucide.createIcons();

            progressContainer.classList.add('active');

            try {
                ffmpeg.FS('writeFile', 'input.mp4', await fetchFile(currentVideoFile));

                // Load font and write text file if overlay text is present
                if (overlayText) {
                    const fontMap = {
                        'arial.ttf': CONFIG.FONT_BASE_URL + 'arial.ttf',
                        'Anton-Regular.ttf': CONFIG.FONT_BASE_URL + 'Anton-Regular.ttf',
                        'Orbitron.ttf': CONFIG.FONT_BASE_URL + 'Orbitron-Regular.ttf',
                        'PermanentMarker-Regular.ttf': CONFIG.FONT_BASE_URL + 'PermanentMarker-Regular.ttf',
                        'Montserrat-Regular.ttf': CONFIG.FONT_BASE_URL + 'Montserrat-Regular.ttf'
                    };

                    const fontUrl = fontMap[fontStyle] || CONFIG.FONT_URL;
                    const fontName = fontStyle.split('.')[0];

                    progressStatus.textContent = 'Loading Font...';

                    // A. Update Browser Font System (for Canvas measurement)
                    if (fontStyle !== 'arial.ttf') {
                        try {
                            const fontFace = new FontFace(fontName, `url(${fontUrl})`);
                            const loadedFace = await fontFace.load();
                            document.fonts.add(loadedFace);
                            await document.fonts.ready; // Wait for the font system to stabilize
                        } catch (e) {
                            console.warn("Browser font load failed, falling back to estimation:", e);
                        }
                    }

                    // B. Update FFmpeg Filesystem
                    ffmpeg.FS('writeFile', fontStyle, await fetchFile(fontUrl));

                    // C. Smart Wrap Logic: Zero-Guesswork Canvas measurement
                    const wordSpacing = parseInt(document.getElementById('wordSpacing').value) || 0;

                    // Verify font is actually loaded in the browser's engine before measuring
                    const fontReady = document.fonts.check(`${textSize}px "${fontName}"`);
                    if (!fontReady) {
                        console.warn(`Font ${fontName} not verified in browser cache. Waiting for system...`);
                        await document.fonts.ready;
                    }

                    // Use 80% of width for a professional, centered "Safe Zone" layout
                    const wrapped = wrapText(overlayText.trim(), width * 0.8, textSize, fontName, wordSpacing);

                    ffmpeg.FS('writeFile', 'overlay_text.txt', new TextEncoder().encode(wrapped));
                }

                // --- Part 1: Build the Base Filter Chain ---
                let baseFilters = [];

                // A. Crop
                if (cropData.active && cropData.w > 0) {
                    const rect = videoPlayer.getBoundingClientRect();
                    const scaleX = videoPlayer.videoWidth / rect.width;
                    const scaleY = videoPlayer.videoHeight / rect.height;
                    const cW = Math.round(cropData.w * scaleX);
                    const cH = Math.round(cropData.h * scaleY);
                    const cX = Math.round(cropData.x * scaleX);
                    const cY = Math.round(cropData.y * scaleY);
                    baseFilters.push(`crop=${cW}:${cH}:${cX}:${cY}`);
                }

                // B. Speed
                if (speed !== 1) baseFilters.push(`setpts=${1 / speed}*PTS`);

                // C. Visual Filters
                if (currentFilter === 'grayscale') baseFilters.push('hue=s=0');
                if (currentFilter === 'sepia') baseFilters.push('colorchannelmixer=.393:.769:.189:0:.349:.686:.168:0:.272:.534:.131');
                if (currentFilter === 'vibrant') baseFilters.push('eq=saturation=1.5:contrast=1.1');
                if (currentFilter === '8bit') baseFilters.push('scale=iw/4:-1,scale=iw*4:-1:flags=neighbor');
                if (currentFilter === 'dreamy') baseFilters.push('eq=contrast=0.8:brightness=0.05:saturation=0.7');
                if (currentFilter === 'golden') baseFilters.push('hue=h=10:s=1.2');
                if (currentFilter === 'gladiator') baseFilters.push('curves=strong_contrast');
                if (currentFilter === 'nightvision') baseFilters.push('hue=h=120:s=0,format=gray,colorlevels=rimin=0.1:gimin=0.1:bimin=0.1:rimax=0.5:gimax=1:bimax=0.5');
                if (currentFilter === 'sulphur') baseFilters.push('hue=h=60:s=2');
                if (currentFilter === 'coldblue') baseFilters.push('hue=h=200:s=0.5');
                if (currentFilter === 'vignette') baseFilters.push('vignette');
                if (currentFilter === 'mirror') baseFilters.push('hflip');
                if (currentFilter === 'grain') baseFilters.push('noise=all_seed=6:all_strength=10:all_flags=t+u');
                if (currentFilter === 'invert') baseFilters.push('negate');
                if (currentFilter === 'vhs') baseFilters.push('hue=s=0.5,noise=alls=10:allf=t+u,boxblur=1:1');
                if (currentFilter === 'psychedelic') baseFilters.push('hue=h=\'t*100\',curves=all=\'0/0 0.5/1 1/0\'');

                // D. Sizing & FPS
                // Force even dimensions to prevent "width/height not divisible by 2" errors
                baseFilters.push(`scale=${width}:-2:flags=lanczos`);
                baseFilters.push(`fps=${fps}`);

                // E. Text Overlay
                if (overlayText) {
                    let yPos;
                    switch (textPos) {
                        case 'top': yPos = '20'; break;
                        case 'middle': yPos = '(h-text_h)/2'; break;
                        case 'bottom': yPos = '(h-text_h-20)'; break;
                        default: yPos = '(h-text_h-20)';
                    }

                    const lineSpacing = parseInt(document.getElementById('lineSpacing').value) || 10;
                    const useBox = document.getElementById('textBox').value === "1" ? 1 : 0;
                    const boxPadding = parseInt(document.getElementById('boxPadding').value) || 10;
                    const textColor = document.getElementById('textColor').value;
                    const boxOpacity = document.getElementById('boxOpacity').value;

                    baseFilters.push(`drawtext=fontfile=${fontStyle}:textfile=overlay_text.txt:fontsize=${textSize}:fontcolor=${textColor}:borderw=2:bordercolor=black:line_spacing=${lineSpacing}:box=${useBox}:boxcolor=black@${boxOpacity}:boxborderw=${boxPadding}:x=(w-text_w)/2:y=${yPos}`);
                }

                const baseFilterStr = baseFilters.join(',');

                // --- Part 2: Two-Pass Palette Generation ---
                progressStatus.textContent = 'Pass 1: Analyzing...';

                // Pass 1: Simple palettegen from filtered video
                await ffmpeg.run(
                    '-fflags', '+genpts',
                    '-ss', start.toString(),
                    '-t', (duration / speed).toString(),
                    '-i', 'input.mp4',
                    '-vf', `${baseFilterStr},palettegen`,
                    '-y', 'palette.png'
                );

                progressStatus.textContent = 'Pass 2: Encoding...';

                // Pass 2: Handle Loop Modes + Palette Application
                let complexFilter = `[0:v]${baseFilterStr}`;

                if (loopMode === 'reverse') {
                    complexFilter += `,reverse[vid];[vid][1:v]paletteuse`;
                } else if (loopMode === 'boomerang') {
                    complexFilter += `,split[f][b];[b]reverse[r];[f][r]concat=n=2:v=1:a=0[vid];[vid][1:v]paletteuse`;
                } else {
                    complexFilter += `[vid];[vid][1:v]paletteuse`;
                }

                await ffmpeg.run(
                    '-fflags', '+genpts',
                    '-ss', start.toString(),
                    '-t', (duration / speed).toString(),
                    '-i', 'input.mp4',
                    '-i', 'palette.png',
                    '-filter_complex', complexFilter,
                    '-f', 'gif',
                    '-y', 'output.gif'
                );

                let data;
                try {
                    data = ffmpeg.FS('readFile', 'output.gif');
                } catch (e) {
                    let logError = ffmpegLogs.length > 0 ? " Last error: " + ffmpegLogs[ffmpegLogs.length - 1] : "";
                    throw new Error("GIF generation failed during encoding." + logError);
                }

                if (!data || data.length < 100) {
                    let logError = ffmpegLogs.length > 0 ? " Last error: " + ffmpegLogs[ffmpegLogs.length - 1] : "";
                    throw new Error("GIF output is empty ‚Äî FFmpeg filter may be invalid for this video." + logError);
                }

                const resultGif = document.getElementById('resultGif');
                if (resultGif.src) {
                    URL.revokeObjectURL(resultGif.src);
                }

                const url = URL.createObjectURL(new Blob([data.buffer], { type: 'image/gif' }));
                resultGif.src = url;

                // Update download link
                const downloadBtn = document.getElementById('downloadBtn');
                downloadBtn.href = url;
                downloadBtn.download = `sumosized-${Date.now()}.gif`;

                document.getElementById('previewSection').classList.add('active');
                showToast('Elite GIF Generated!');
                document.getElementById('previewSection').scrollIntoView({ behavior: 'smooth' });

                // Cleanup virtual files
                try {
                    ffmpeg.FS('unlink', 'input.mp4');
                    ffmpeg.FS('unlink', 'palette.png');
                    ffmpeg.FS('unlink', 'output.gif');
                    if (overlayText) ffmpeg.FS('unlink', 'overlay_text.txt');
                    if (fontStyle && fontStyle !== 'arial.ttf') {
                        try { ffmpeg.FS('unlink', fontStyle); } catch (e) { }
                    }
                } catch (e) { }

            } catch (error) {
                console.error("Conversion Error:", error);
                showToast('Processing Error: ' + error.message);
            } finally {
                resetConversionState();
            }
        }

        function resetConversionState() {
            isConverting = false;
            const convertBtn = document.getElementById('convertBtn');
            const progressContainer = document.getElementById('progressContainer');
            const progressFill = document.getElementById('progressFill');

            if (convertBtn) {
                convertBtn.disabled = false;
                convertBtn.innerHTML = '‚ö° Convert to GIF';
            }
            if (progressContainer) progressContainer.classList.remove('active');
            if (progressFill) progressFill.style.width = '0%';
        }

        function resetVideo() {
            const videoPlayer = document.getElementById('videoPlayer');
            const videoSection = document.getElementById('videoSection');
            const controlsPanel = document.getElementById('controlsPanel');
            const actionSection = document.getElementById('actionSection');
            const previewSection = document.getElementById('previewSection');
            const videoInput = document.getElementById('videoInput');
            const resultGif = document.getElementById('resultGif');
            const downloadBtn = document.getElementById('downloadBtn');

            if (videoPlayer && videoPlayer.src) {
                URL.revokeObjectURL(videoPlayer.src);
                videoPlayer.src = '';
            }
            if (resultGif && resultGif.src) {
                URL.revokeObjectURL(resultGif.src);
                resultGif.src = '';
            }
            if (downloadBtn) {
                downloadBtn.href = '';
            }
            if (videoSection) videoSection.classList.remove('active');
            if (controlsPanel) controlsPanel.style.display = 'none';
            if (actionSection) actionSection.style.display = 'none';
            if (previewSection) previewSection.classList.remove('active');
            if (videoInput) videoInput.value = '';

            videoDuration = 0;
            currentVideoFile = null;
        }

        function closePreview() {
            document.getElementById('previewSection').classList.remove('active');
        }

        function showToast(message) {
            const toast = document.getElementById('toast');
            toast.textContent = message;
            toast.classList.add('show');
            setTimeout(() => {
                toast.classList.remove('show');
            }, 3000);
        }
    </script>
</body>

</html>